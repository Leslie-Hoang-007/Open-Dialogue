<!doctype html>
<html>

<head>
  <title>Socket.IO chat</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font: 13px Helvetica, Arial;
    }

    form {
      background: #000;
      padding: 3px;
      position: fixed;
      bottom: 0;
      width: 100%;
    }

    form input {
      border: 0;
      padding: 10px;
      width: 90%;
      margin-right: .5%;
    }

    form button {
      width: 9%;
      background: rgb(130, 224, 255);
      border: none;
      padding: 10px;
    }

    #messages {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    #messages li {
      padding: 5px 10px;
    }

    #messages li:nth-child(odd) {
      background: #eee;
    }
  </style>
</head>

<body>
  <div id="loginContainer">
    <form action="" id="submitName">
      <input type="text" id="name" autocomplete="given-name" /> <button>Submit Name</button>
    </form>
  </div>
  <div id="postContainer">
    <ul id="messages"></ul>
    <form action="" id="submitPost">
      <input type="text" id="post" autocomplete="off" /> <button>Submit</button>
    </form>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/vue@3"></script>
  <script src="https://unpkg.com/vuex@4"></script>

  <script>
    // init ui
    $("#postContainer").hide();

    // Initialize Socket.IO connection
    var socket = io();
    // Await post update from Server
    socket.on('serverReply', function (post) {
      // Log the received message
      console.log("Received:", post);
      // Append the message to the list
      $('#messages').append($('<li>').text(post));
    });


    // put the raw data onto the DOM and log it to the console
    const plugin = function createWebSocketPlugin() {
      return (store) => {
        socket.on('post', data => {

          //document.getElementById("app").innerHTML +=
          // JSON.stringify(data) + "<br /> <br /> <br /> <br />";
          store.commit('update_posts', data)
        });


      }
    }
    const store = Vuex.createStore({
      state() {
        return {
          allPosts: [],
        }
      },

      mutations: {

      },
      getters: {

      },

      plugins: [plugin()],
    });

    const app = Vue.createApp({})

    app.component('analy-data', {
      computed: {

      },
      template: ``
    });

    // Handle submie Post
    $('#submitPost').submit(function () {
      // Get input value
      var post = $('#post').val();

      // Log the message
      console.log(post);

      // Emit 'sentPost' event to the server
      socket.emit('sentPost', post);

      // Clear the input field
      $('#post').val('');

      return false;
    });

    // handle submit Name
    $('#submitName').submit(function () {
      // Get input value
      var name = $('#name').val();

      // Log the message
      console.log("Name:", name);

      axios.post('/submitName', { name: "asdf" })
        .then(function (response) {
          console.log(response.data);

          // Show post container
          $("#postContainer").show();
        })
        .catch(function (error) {
          console.error(error);
        });

      return false;
    });

    app.use(store)
    app.mount('#app')

  </script>
</body>

</html>